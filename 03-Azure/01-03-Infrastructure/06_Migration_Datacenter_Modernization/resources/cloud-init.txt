#cloud-config
package_update: true
package_upgrade: true
packages:
  - httpd
write_files:
  - owner: www-data:www-data
    path: /etc/nginx/sites-available/default
    defer: true
    content: |
        server {
            listen 80;
            server_name example.com;  # Replace with your domain or IP address

            root /var/www/html;  # Path to your static files

            location / {
                try_files $uri $uri/ =404;
            }

            location = / {
                index index.html;  # Serve index.html as the default file
            }
        }
runcmd:
- pathToRepo="https://raw.githubusercontent.com/microsoft/MicroHack/main/03-Azure/01-03-Infrastructure/06_Migration_Datacenter_Modernization/resources/demopage"
- pathToIndex="/var/www/html/index.html"
- replaceText="<HOSTNAME>"
- hostname=$(hostname)
- rm -rf /var/www/html/*
- wget "$pathToRepo/index.html" -O $pathToIndex
- wget "$pathToRepo/GitHub_Logo.png" -O /var/www/html/GitHub_Logo.png
- wget "$pathToRepo/MSLogo.png" -O /var/www/html/MSLogo.png
- wget "$pathToRepo/MSicon.png" -O /var/www/html/MSicon.png
- wget "$pathToRepo/github-mark.png" -O /var/www/html/github-mark.png
- wget "$pathToRepo/stylesheet.css" -O /var/www/html/stylesheet.css
- sed -i "s|$replaceText|$hostname|g" $pathToIndex
- systemctl reload nginx