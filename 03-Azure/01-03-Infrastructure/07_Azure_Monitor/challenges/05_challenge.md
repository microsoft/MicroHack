# Challenge 5: Collect custom text logs with Azure Monitor Agent

Azure Monitor allows you to collect logs from various sources, including custom logs. Custom logs are logs that are generated by your own applications or services and can be collected using the Azure Monitor agent. You can configure the agent to collect logs from specific files or directories on your virtual machines or from specific event logs on Windows machines. Once collected, you can analyze and query the logs using Azure Monitor Log Analytics.

## Goal

After completing this challenge, you should be able to capture custom logs from your Windows virtual machine in Azure Log Analytics.

## Actions

### Task 1

- Create a `Data Collection Endpoint` in the `West Europe` region

### Task 2

- Create a custom table named `MH_MONITORING` inside Azure Log Analytics workspace `law-microhack`.
- Either using
  - the **Azure Portal** - [Create or edit a custom log table](https://docs.microsoft.com/en-us/azure/azure-monitor/logs/data-platform-logs#custom-tables)
    - The `_CL` suffix is added automatically to the name you specify.
    - Create a new `Data Collection Rule`. Fill in parameters from the following section.
    - A JSON schema with sample logs for the custom table is provided in `./resources/scripts/sample.json`
  - the **PowerShell** script `./resources/scripts/create-custom-table.ps1`
    - You need to provide the `subscriptionId` inside the script.
    - Create a new `Data Collection Rule`. Fill in parameters from the following section.

#### Data Collection Rule

- Consider the following configuation parameters when creating or updating the `Data Collection Rule`
  - `Data Collection Rule Name`: `dcr-custom-vm-windows`
  - `Data Source Type`: `Custom Logs`
  - `File pattern`: `C:\JavaLogs\TestLog-*.log` - Identifies where the log files are located on the local disk.
  - `Table Name`: `MH_MONITORING_CL`

### Task 3

- Add `vm-windows` to the `dcr-custom-vm-windows` Data Collection Rule

### Task 4

- Generate sample logs on your virutal machine.
- Find a sample script in `./resources/scripts/generate-logs.ps1` which you can execute on `vm-windows`. Connect via RDP and run the script in PowerShell.

### Task 5

- Verify custom table `MH_MONITORING_CL` and logs are gathered in Log Analytics workspace `law-microhack`.

### Learning Resources

- [Collect text logs with Azure Monitor Agent](https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-collection-text-log?tabs=portal)
- [Add or delete tables and columns in Azure Monitor Logs](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/create-custom-table?tabs=azure-portal-1%2Cazure-portal-2%2Cazure-portal-3)

## Success Criteria

- Custom table `MH_MONITORING_CL` was created
- Data Collection Rule gathers custom text logs from `vm-windows`
- Run example query in `law-microhack` demonstrating succesfull collection of custom logs.

### Congrats :partying_face:

You finished the MicroHack for monitoring virutal machines in Azure Monitor.
